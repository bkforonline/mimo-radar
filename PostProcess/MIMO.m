%%
% MIMO Radar Signal Processing
% By: Zhengyu Peng (zhengyu.peng@ttu.edu)
% Feb. 25, 2018
%
%% clear workspace
clear;
close all;
datestr(now)
%% import data
dataFolder='3 targets close';

list= importdata(strcat(dataFolder,'/list'));

list=char(list(2:65));
list=list(:,2:2:50);

for ii=1:64
    data(ii,:)=importdata(strcat(dataFolder,'/',list(ii,:)));
end

data=data(:,32:2510); % edge blocking
data=data-mean(data,2); % remove mean value
[nr,nc]=size(data);

%% radar parameters
fs=240e3; % sampling frequency
chirp=100; % (Hz) frequency of chirp signal
BW=250E6; % bandwidth
Nfft=2^20; % zero-padding
freq=0:fs/Nfft:fs;
c=3e8; % speed of light
rr = c/(2*BW);
max_range = rr*fix(fs/chirp)/2;

range=0:max_range*2/Nfft:max_range*2-max_range*2/Nfft;

%% range profile
SpecData=fft(data.*repmat(taylorwin(nc,5,-30)',nr,1),Nfft,2);
SpecDataLog=20*log10(abs(SpecData));

%figure(10);
%imagesc(linspace(0,max_range*2,Nfft),1:64,SpecDataLog);

%figure(11);
%imagesc(linspace(0,max_range*2,Nfft),1:64,angle(SpecData));

% figure(12);
% for ii=1:64
%     plot(range, SpecDataLog(ii,:));
%     hold on;
% end
% hold off;
% axis([0,10,0,50]);

%% remove near range data
startRange=1;
startPoint=fix(startRange/(max_range*2/Nfft));

%% calibration data
shift=[0,-179,-83,-98,-222,-166,-153,-30,-186,-86,-114,-70,-109,-130,-134,-66,-38,-192,-120,-51,-125,-144,-179,17,-132,-133,-99,-149,-152,-178,-165,-57,-159,-93,-101,-143,-109,-145,-121,-18,-108,-107,-107,-134,-160,-170,-205,-65,-55,-151,-86,-123,-136,-131,-39,-20,-234,-28,-54,-57,-127,-107,21,30];
weight=[0.0198700400815627 + 0.00000000000000i,0.00793219735918225 + 0.0130667281530871i,0.00993019144926023 + 0.00949477299630856i,-0.0143106459488229 + 0.00173426262365620i,-0.00679127351695644 - 0.0194406011899604i,0.00571783922887744 + 0.0120249943838191i,0.0169296476744560 + 0.00590896076169227i,0.00609413091995528 - 0.0142985575666115i,0.00799498301967454 - 0.0197532776144351i,-0.00608887415068463 + 0.0211205686293043i,0.0114062682285175 + 0.0117484102150679i,-0.0163737366411451 - 0.00683478943940930i,0.00673710834272552 - 0.0205023165033952i,0.00309704462205184 + 0.0154245386459240i,0.0204943832039357 + 0.00690515688943897i,-0.000270944711171891 - 0.0203133634356923i,0.0333166804602493 - 0.00671913769897514i,0.00981586385986673 + 0.0209201260931694i,0.0151109928054690 + 0.0149454750415126i,-0.0225138912520338 - 0.00832820092696941i,0.00404692203403867 - 0.0283075934374731i,0.00876794521761145 + 0.0200281322128687i,0.0263616472591972 - 0.0111764649015112i,0.0170442419084958 - 0.0300975642692243i,0.00861291704344803 - 0.0245953204138834i,0.0117263663545549 + 0.0220173096536662i,0.0170210975512956 + 0.0107037813365532i,-0.0174044348438379 + 0.0114952512567712i,-0.00633362566161492 - 0.0236828801990175i,0.0103348342287342 + 0.0173545518262058i,0.0286999353740706 + 0.000119037523082923i,-0.000185330916806143 - 0.0246960387035237i,0.00819943202572360 - 0.0219500756714932i,5.26940924560985e-05 + 0.0229582060133678i,0.0127851690920725 + 0.00989955089091876i,-0.0161642823713949 + 0.00506380240589889i,0.00141717101590997 - 0.0188132189164667i,0.00450740170303402 + 0.0137540885250482i,0.0159317777886062 + 0.00895935636497234i,0.00811622173349043 - 0.0155663246904947i,0.0134683715785399 - 0.0118578429883352i,0.000518746650046418 + 0.0204199566588695i,0.0121488753176984 + 0.00808484728291028i,-0.0149696214966901 + 0.00464885369230423i,-0.00571956366352949 - 0.0188926000259965i,0.00791728843521788 + 0.0127346408509149i,0.0187239520627265 - 0.00895928874931303i,-0.00288110346427641 - 0.0183809311423295i,0.0253525111882314 + 0.000448813989312049i,-0.00292081286763697 + 0.0210343843388022i,0.00349166236498771 + 0.0140393865863401i,-0.0140004290281800 - 0.00747602228451658i,0.00875037217036885 - 0.0146443964043363i,-0.00442291809930084 + 0.0113246308381115i,-0.00313137618744777 + 0.0146100256052855i,0.0117773222375246 - 0.00725066486157689i,0.0229925089612720 - 0.0133043300751357i,-0.0231896058092873 + 0.00104366628452466i,-0.00528474915118643 + 0.0169232225107775i,-0.00769801031837986 - 0.0176511815331739i,0.0176170424612595 - 0.0151736739255816i,-0.00972416819833671 + 0.0149380409186764i,-0.0127044748124437 + 0.0166726989317259i,0.0188714990432214 - 0.00436517480708288i];

%% apply calibration
for ii=1:64
    calSpecData(ii,:)=SpecData(ii,startPoint+shift(ii):Nfft/2+shift(ii));
end
calSpecData=calSpecData.*(weight.');
calSpecDataLog=20*log10(abs(calSpecData));

% figure(20);
% imagesc(linspace(startRange,max_range,Nfft/2-startPoint),1:64,calSpecDataLog,[-40,0]);
% axis([startRange,10,1,64]);

rangeCal=startRange:max_range*2/Nfft:max_range+max_range*2/Nfft;
% figure(21);
% for ii=1:64
%     plot(rangeCal, calSpecDataLog(ii,:));
%     hold on;
% end
% hold off;
% axis([startRange,10,-30,0]);

% figure(22);
% for ii=1:64
%     plot(rangeCal, (angle(calSpecData(ii,:)))/pi*180);
%     hold on;
% end
% hold off;
% axis([startRange,10,-180,180]);

%% weighting
% Weighting values, from -45 degrees to 45 degress with 2.5 degrees step
Weight_N45_45_2P5=[0.124980500825075 - 0.0925520614513267i,0.153197257450044 + 0.0518743722935645i,-0.00269761551830797 - 0.146535528364265i,-0.0285943869376831 + 0.104123308888121i,-0.0684299129661230 - 0.103253936437119i,-0.0122230660336305 + 0.193396102090452i,0.0393176937267055 - 0.0577958077640303i,-0.00142686889538273 + 0.231150067525983i;
    0.0794687022204536 - 0.0259156073026596i,0.108423210755204 + 0.127400786092459i,0.0465403265476671 - 0.170909209315201i,-0.0891011475529826 + 0.0608117804087783i,-0.0159230423787575 - 0.0949222381903245i,-0.0901051570121822 + 0.135324566401981i,0.0708636698777911 + 0.0805166696128105i,-0.147667009169495 + 0.0760451042820783i;
    0.0641592867347555 - 0.00949813218645218i,0.0213414496230591 + 0.171004670288957i,0.126305559844362 - 0.125331188457008i,-0.140077853533412 - 0.00898555473933959i,0.0290687944868934 - 0.0721485142088897i,-0.148705460650750 + 0.0589554743071804i,-0.0422836884253894 + 0.102505871797712i,-0.0955462768022038 - 0.0555310933213185i;
    0.0715618598352142 - 0.00155998692134316i,-0.0512368931390910 + 0.168287951844260i,0.165073286738163 - 0.0620026688010386i,-0.136789240571641 - 0.100003054890159i,0.0522244129963581 - 0.0392628074599706i,-0.151012271992216 - 0.0604316962293737i,-0.0990821935971837 + 0.00696175864154757i,0.0188756527892397 - 0.0897856111137135i;
    0.0928209610046075 + 0.00495594931381134i,-0.0912781730687020 + 0.156996604050241i,0.161718137285392 - 0.00194732923719590i,-0.0626764016846748 - 0.140310103975413i,0.0863806590074467 + 0.0189027134757269i,-0.0525735694769123 - 0.166022814505944i,-0.0263058761563444 - 0.0688739673591595i,0.0836000034214631 + 0.0131655318974709i;
    0.0957122358091446 + 0.00509147724789540i,-0.130256211422009 + 0.130256650349078i,0.150611723101165 + 0.0592553560442468i,0.0178226529676430 - 0.150743649210878i,0.0475558914870269 + 0.0763956850412260i,0.0988973283808600 - 0.142688557807085i,0.0577332876888487 - 0.0405696931032416i,-0.0121926030424137 + 0.0817372347324151i;
    0.0978445209285275 + 0.00506752423409989i,-0.161255946887193 + 0.0925354851352922i,0.116029590369051 + 0.112832740971671i,0.0931273703394470 - 0.117821805036451i,-0.0238169499043092 + 0.0883168567649141i,0.173132044846452 - 0.00387962466965137i,0.0499386783292746 + 0.0463251802603971i,-0.0800081575646698 - 0.0152302852212058i;
    0.0995719062522806 + 0.00487658017649856i,-0.181619980257005 + 0.0461051059125061i,0.0621877551634249 + 0.149454228176940i,0.140487125831081 - 0.0493332462306415i,-0.0826186822069787 + 0.0420117848777061i,0.101096937571492 + 0.140097454599673i,-0.0358719539423694 + 0.0555571797521578i,0.0216407109621609 - 0.0774477542752392i;
    0.101695618373686 + 0.00584259856959255i,-0.189143888526106 - 0.00715050023834572i,-0.00368059585544303 + 0.162227653083157i,0.143154922846880 + 0.0349517244630393i,-0.0869646148604596 - 0.0349665261397533i,-0.0609578381071498 + 0.160888211347230i,-0.0585171880862048 - 0.0258300119198503i,0.0735328932923071 + 0.0294076369880852i;
    0.103238551998617 + 0.00605630437245191i,-0.180514250289168 - 0.0611247894892446i,-0.0701471467233878 + 0.146448056396241i,0.0987865396380790 + 0.107792611928387i,-0.0298254440831682 - 0.0900322708660254i,-0.168208798603607 + 0.0340118659332583i,0.0182105736545678 - 0.0594582398355723i,-0.0397307584236718 + 0.0675137049924284i;
    0.104858767920655 + 0.00638377758385419i,-0.155896761387194 - 0.112022190087344i,-0.125230197364286 + 0.103746484301190i,0.0204564334818207 + 0.143544730805173i,0.0510063282098636 - 0.0811331430465989i,-0.115769238179036 - 0.125985531777502i,0.0591959384958559 + 0.0121478103967238i,-0.0585918747674234 - 0.0506620304236720i;
    0.0941338030626034 + 0.0242651039938633i,-0.119750386486622 - 0.151872366784563i,-0.164744896155064 + 0.0346511307870571i,-0.0526009671829685 + 0.142131178686511i,0.111795043989304 - 0.0214387720410829i,0.0506526356078507 - 0.155645470689586i,-0.0120705060381435 + 0.0474320226726926i,0.0563818309424651 - 0.0474588983772236i;
    0.0656998881100530 + 0.0184211387214613i,-0.0478428299310130 - 0.157583133750051i,-0.156450215211316 - 0.0265663081293699i,-0.143519843726103 + 0.106043016765532i,0.115771343073836 + 0.0675802695134326i,0.181758552483367 - 0.0153827920273479i,-0.0461394559811061 - 0.0178370949525585i,0.0311858392503086 + 0.0767270185131491i;
    0.0661695069319062 + 0.0142329864717145i,0.00815907218624436 - 0.163479326114603i,-0.118323468865375 - 0.0910528010972096i,-0.178770372814260 - 0.00304942142245222i,0.0200876611431450 + 0.145804645279493i,0.111143276883341 + 0.157577320360475i,0.0149152680659349 - 0.0365011746414813i,-0.0772639642874245 + 0.0157726478901320i;
    0.0926075910926738 - 0.0180587832787049i,0.0646993618658201 - 0.160844314021835i,-0.0561660825377245 - 0.120560728804174i,-0.127116644253509 - 0.0886468127637177i,-0.134498025544558 + 0.123269338253003i,-0.0961069238018533 + 0.187262519802480i,0.0144121299441234 + 0.0112400969147919i,0.0229245501245615 - 0.0417163432170651i;
    0.113728876461434 - 0.0106449570426889i,0.0909387294939510 - 0.101814508359740i,0.00572938182185208 - 0.130034991613192i,-0.0597087394105318 - 0.140586525321622i,-0.190800229833761 - 0.0546578710436757i,-0.212677630425264 + 0.00929438689027337i,0.00294284991698911 - 0.000443569673365153i,0.0401860429026780 + 0.0467117897194799i;
    0.101650057114646 - 0.000906098757599333i,0.0848251603131133 - 0.0622661622699815i,0.0607158842336328 - 0.0892832340488007i,0.0392057324353078 - 0.155339970990979i,-0.0642706121817588 - 0.201321314770783i,-0.134787936908521 - 0.192422337503771i,-0.00454315597496221 - 0.00302356869260879i,-0.0645498997618775 + 0.0379296292362165i;
    0.0848848333901486 + 0.000695922191632881i,0.0822760688565828 - 0.0279284614516063i,0.0854756862142897 - 0.0430399684869749i,0.132544761972046 - 0.102171143916791i,0.127110001039458 - 0.172869776945975i,0.111991682286529 - 0.219144085465097i,0.000749455820029796 - 0.0195663001908107i,-0.0249907026109536 - 0.0812222467361768i;
    0.0845413112698872 - 3.91198228253241e-13i,0.0864880244185554 - 4.30446833020862e-14i,0.0951143753822931 + 1.76292852241171e-14i,0.167781055095530 + 4.19925684685815e-13i,0.214583374099184 + 3.06634578032049e-13i,0.246667100212340 - 7.00950311423209e-14i,0.0199052662662607 - 2.38726721763042e-13i,0.0849194932559491 - 1.12488348207886e-15i;
    0.0848848333974144 - 0.000695922172346678i,0.0822760689425207 + 0.0279284614955764i,0.0854756862777289 + 0.0430399684908161i,0.132544761904842 + 0.102171143830069i,0.127110001102632 + 0.172869776986742i,0.111991682256535 + 0.219144085416443i,0.000749455796738647 + 0.0195663001936213i,-0.0249907026064186 + 0.0812222466618998i;
    0.101650057047325 + 0.000906098769921840i,0.0848251602717610 + 0.0622661622132033i,0.0607158842403729 + 0.0892832340545436i,0.0392057323957286 + 0.155339971042854i,-0.0642706122318683 + 0.201321314748263i,-0.134787936853026 + 0.192422337527592i,-0.00454315603966244 + 0.00302356869296108i,-0.0645498998175699 - 0.0379296292324972i;
    0.113728876461675 + 0.0106449570355058i,0.0909387295007915 + 0.101814508365405i,0.00572938182988525 + 0.130034991619475i,-0.0597087394117298 + 0.140586525318865i,-0.190800229828466 + 0.0546578710394104i,-0.212677630417215 - 0.00929438688411145i,0.00294284992375083 + 0.000443569672049173i,0.0401860429083730 - 0.0467117897110663i;
    0.0926075910919856 + 0.0180587832784891i,0.0646993618659863 + 0.160844314021545i,-0.0561660825376818 + 0.120560728802700i,-0.127116644253718 + 0.0886468127639987i,-0.134498025545427 - 0.123269338253490i,-0.0961069238020337 - 0.187262519803713i,0.0144121299443833 - 0.0112400969147700i,0.0229245501243425 + 0.0417163432166578i;
    0.0661695069600482 - 0.0142329865363703i,0.00815907216312953 + 0.163479326064190i,-0.118323468944570 + 0.0910528011795955i,-0.178770372827506 + 0.00304942138460801i,0.0200876611177587 - 0.145804645153097i,0.111143276800296 - 0.157577320275719i,0.0149152680580149 + 0.0365011746719046i,-0.0772639643933778 - 0.0157726479101337i;
    0.0656998881265342 - 0.0184211387225635i,-0.0478428299341644 + 0.157583133752733i,-0.156450215204371 + 0.0265663081297439i,-0.143519843711989 - 0.106043016759623i,0.115771343085407 - 0.0675802695264523i,0.181758552488263 + 0.0153827920271254i,-0.0461394559601619 + 0.0178370949495577i,0.0311858392479578 - 0.0767270185133093i;
    0.0941338030780892 - 0.0242651039825173i,-0.119750386503040 + 0.151872366810931i,-0.164744896156440 - 0.0346511307551637i,-0.0526009671961668 - 0.142131178659617i,0.111795043995462 + 0.0214387720296129i,0.0506526355721289 + 0.155645470702942i,-0.0120705060295809 - 0.0474320226685393i,0.0563818309128990 + 0.0474588983746457i;
    0.104858767827134 - 0.00638377756521496i,-0.155896761348813 + 0.112022190058718i,-0.125230197364424 - 0.103746484315657i,0.0204564335103949 - 0.143544730895239i,0.0510063281558956 + 0.0811331429848616i,-0.115769238159658 + 0.125985531794999i,0.0591959385940964 - 0.0121478104240104i,-0.0585918747799821 + 0.0506620304417613i;
    0.103238552007205 - 0.00605630437403790i,-0.180514250295764 + 0.0611247894873667i,-0.0701471467252779 - 0.146448056387727i,0.0987865396288312 - 0.107792611919826i,-0.0298254440848213 + 0.0900322708827438i,-0.168208798607792 - 0.0340118659367279i,0.0182105736485857 + 0.0594582398236809i,-0.0397307584198267 - 0.0675137049895997i;
    0.101695618459375 - 0.00584259834759900i,-0.189143888556188 + 0.00715050004702806i,-0.00368059574112972 - 0.162227653027349i,0.143154922763247 - 0.0349517244863757i,-0.0869646149713492 + 0.0349665261781907i,-0.0609578381625038 - 0.160888211379331i,-0.0585171878892466 + 0.0258300120726083i,0.0735328931751704 - 0.0294076372049940i;
    0.0995719062499983 - 0.00487658017667179i,-0.181619980258737 - 0.0461051059125505i,0.0621877551660160 - 0.149454228175457i,0.140487125833916 + 0.0493332462332075i,-0.0826186822050278 - 0.0420117848772005i,0.101096937571188 - 0.140097454600608i,-0.0358719539440956 - 0.0555571797535575i,0.0216407109622503 + 0.0774477542721132i;
    0.0978445209419666 - 0.00506752423335589i,-0.161255946892847 - 0.0925354851357712i,0.116029590370168 - 0.112832740972324i,0.0931273703286421 + 0.117821805025120i,-0.0238169499049410 - 0.0883168567713752i,0.173132044844925 + 0.00387962466493241i,0.0499386783232508 - 0.0463251802519947i,-0.0800081575638958 + 0.0152302852245394i;
    0.0957122357999901 - 0.00509147722383914i,-0.130256211467487 - 0.130256650349161i,0.150611723117044 - 0.0592553560321761i,0.0178226529440348 + 0.150743649228070i,0.0475558915009232 - 0.0763956849947352i,0.0988973284076629 + 0.142688557785013i,0.0577332877050086 + 0.0405696931200797i,-0.0121926030613246 - 0.0817372346913662i;
    0.0928209610045428 - 0.00495594931359383i,-0.0912781730689952 - 0.156996604050013i,0.161718137285915 + 0.00194732923713273i,-0.0626764016847792 + 0.140310103975738i,0.0863806590067825 - 0.0189027134752113i,-0.0525735694767304 + 0.166022814505565i,-0.0263058761564751 + 0.0688739673594802i,0.0836000034215930 - 0.0131655318975421i;
    0.0715618598351960 + 0.00155998692150025i,-0.0512368931391935 - 0.168287951844258i,0.165073286738394 + 0.0620026688006894i,-0.136789240571471 + 0.100003054890086i,0.0522244129962769 + 0.0392628074600261i,-0.151012271992164 + 0.0604316962293773i,-0.0990821935972569 - 0.00696175864170572i,0.0188756527891276 + 0.0897856111137696i;
    0.0641592867348606 + 0.00949813218641483i,0.0213414496230820 - 0.171004670288601i,0.126305559843895 + 0.125331188457803i,-0.140077853534331 + 0.00898555473975221i,0.0290687944864318 + 0.0721485142085427i,-0.148705460650410 - 0.0589554743075502i,-0.0422836884260866 - 0.102505871797235i,-0.0955462768022608 + 0.0555310933219110i;
    0.0794687022177047 + 0.0259156073023097i,0.108423210755695 - 0.127400786093654i,0.0465403265464042 + 0.170909209317555i,-0.0891011475526336 - 0.0608117804070824i,-0.0159230423790906 + 0.0949222381906811i,-0.0901051570077701 - 0.135324566402089i,0.0708636698769917 - 0.0805166696174315i,-0.147667009170675 - 0.0760451042817081i;
    0.124980500823958 + 0.0925520614515066i,0.153197257450014 - 0.0518743722932815i,-0.00269761551822032 + 0.146535528364400i,-0.0285943869353334 - 0.104123308887051i,-0.0684299129656310 + 0.103253936439277i,-0.0122230660337700 - 0.193396102090565i,0.0393176937289239 + 0.0577958077636173i,-0.00142686889300786 - 0.231150067525434i];

%% 2D beamforming horizontal
% Beamforming with T0 and R0-R7
for ii=1:37
    T0(ii,:)=sum(calSpecData(1:8,:).*(Weight_N45_45_2P5(ii,:)'),1);
end

T0Log=20*log10(abs(T0));
% maxAmp=max(max(T0Log));
% figure(30);
% imagesc(linspace(startRange,max_range,Nfft/2-startPoint),1:37,T0Log,[maxAmp-15,maxAmp]);
% axis([startRange,10,1,37]);

maxPlotRange=10; % meters
minPlotRange=startRange; % meters
antennaAngle=-45:2.5:45;
antennaAngle=antennaAngle/180*pi;

minRange2Index=fix(Nfft/2*minPlotRange/max_range);
maxRange2Index=fix(Nfft/2*maxPlotRange/max_range);
disAxial = linspace(0,max_range,Nfft/2); % distance axial

figure(31);
X = disAxial(startPoint:maxRange2Index)'*cos(antennaAngle);
Y = disAxial(startPoint:maxRange2Index)'*sin(antennaAngle);
T0Log=T0Log(:,1:(maxRange2Index-startPoint+1))-max(max(T0Log(:,1:(maxRange2Index-startPoint+1))));
pcolor(Y,X,T0Log');
colorbar;
axis equal;
shading interp;
colormap hot;
caxis([-10 0]);
ylabel('Range (m)');
xlabel('Range (m)');
axis([-10/sqrt(2),10/sqrt(2),startRange/sqrt(2),10]);

%% 2D beamforming vertical
% Beamforming with T0 and T0-T7
for ii=1:37
    R0(ii,:)=sum(calSpecData(1:8:64,:).*(Weight_N45_45_2P5(ii,:)'),1);
end

R0Log=20*log10(abs(R0));

figure(41);
X = disAxial(startPoint:maxRange2Index)'*cos(antennaAngle);
Y = disAxial(startPoint:maxRange2Index)'*sin(antennaAngle);
R0Log=R0Log(:,1:(maxRange2Index-startPoint+1))-max(max(R0Log(:,1:(maxRange2Index-startPoint+1))));
pcolor(Y,X,R0Log');
colorbar;
axis equal;
shading interp;
colormap hot;
caxis([-10 0]);
ylabel('Range (m)');
xlabel('Range (m)');
axis([-10/sqrt(2),10/sqrt(2),startRange/sqrt(2),10]);

%% 3D beamforming
for vAngle=1:37
    for hAngle=1:37
        tempSpecData=calSpecData(:,1:(maxRange2Index-startPoint+1));
        for hh=0:7
            tempSpecData((1+8*hh):(8+8*hh),:)=tempSpecData((1+8*hh):(8+8*hh),:).*(Weight_N45_45_2P5(hAngle,:)');
        end
        for vv=0:7
            tempSpecData((1+vv):8:(57+vv),:)=tempSpecData((1+8*hh):(8+8*hh),:).*(Weight_N45_45_2P5(vAngle,:)');
        end
        threeD(hAngle+37*(vAngle-1),:)=sum(tempSpecData,1);
    end
end

datestr(now)

[rThreeD,cThreeD]=size(threeD);
figure(50);
imagesc(linspace(startRange,maxPlotRange,cThreeD),1:1369,20*log10(abs(threeD)));
% axis([startRange,10,1,37]);

%range1=2.3;
range1=1.6;
range1Index=fix(range1/(max_range*2/Nfft))-startPoint;
%range1Index=614;
%range2=3.75;
range2=2.3;
range2Index=fix(range2/(max_range*2/Nfft))-startPoint;
%range2Index=1616;
%range3=4.88;
range3=3.14;
range3Index=fix(range3/(max_range*2/Nfft))-startPoint;
%range3Index=2677;

image1=zeros(37,37);
image2=zeros(37,37);
image3=zeros(37,37);
for jj=1:37
    for ii=1:37
        image1(ii,jj)=threeD(ii+37*(jj-1),range1Index);
        image2(ii,jj)=threeD(ii+37*(jj-1),range2Index);
        image3(ii,jj)=threeD(ii+37*(jj-1),range3Index);
    end
end

%image1=flipud(image1);
%image2=flipud(image2);
%image3=flipud(image3);

maxAmp=max(max(20*log10(abs(threeD))));

figure(51);
imagesc(1:37,1:37,20*log10(abs(image1))-maxAmp);
colorbar;
axis equal;
shading interp;
colormap hot;
caxis([-4.5 0]);
axis([1,37,1,37]);

figure(52);
imagesc(1:37,1:37,20*log10(abs(image2))-maxAmp);
colorbar;
axis equal;
shading interp;
colormap hot;
caxis([-4.5 0]);
axis([1,37,1,37]);

figure(53);
imagesc(1:37,1:37,20*log10(abs(image3))-maxAmp);
colorbar;
axis equal;
shading interp;
colormap hot;
caxis([-4 0]);
axis([1,37,1,37]);